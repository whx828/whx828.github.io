<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="theme-color" content="#55bb8a">
        <title>AI 来了</title>
<meta name="description" content="今天晚上有点累，同时闲得无聊，而且最近总被 GPT-4/ChatGPT/文心一言刷屏，突然也想跟把风玩玩 AI。">
<meta property="og:type" content="website">
<meta property="og:title" content="AI 来了">
<meta property="og:description" content="今天晚上有点累，同时闲得无聊，而且最近总被 GPT-4/ChatGPT/文心一言刷屏，突然也想跟把风玩玩 AI。">
<meta name="twitter:title" content="AI 来了">
<meta name="twitter:description" content="今天晚上有点累，同时闲得无聊，而且最近总被 GPT-4/ChatGPT/文心一言刷屏，突然也想跟把风玩玩 AI。">
<link rel="shortcut icon" href="path/to/favicon">
<meta property="og:url" content="http://whx828.github.io/s3/2">
    <meta property="twitter:url" content="http://whx828.github.io/s3/2">
<meta name="twitter:card" content="summary_large_image">
    <meta property="og:image" content="http://whx828.github.io/static/2023/llama-rs.png">
    <meta name="twitter:image" content="http://whx828.github.io/static/2023/llama-rs.png">
<link rel="icon" type="image/png" href="/favicon.ico">
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital@1&family=Raleway&family=Roboto+Mono&display=swap"
    rel="stylesheet">
<style>
    body {
        font-family: 'Open Sans', sans-serif;
        font-family: 'Raleway', sans-serif;
    }
</style><link rel="stylesheet" href="/static/zine.css">
        <link rel="alternate"
              type="application/atom+xml"
              title="whx's Blog RSS"
              href="/feed.xml">
        <style>
            :root {
                --primary-color: #55bb8a;
                --main-color: #111111;
                --link-color: #e97312;
                --secondary-color: #baccd9;
            }
        </style>
    </head>
    <body class="h-full bg-secondary">
        <div class="bg-primary text-main font-bold text-center z-0">
                <header class="p-8 md:p-10">
                    <div class="text-4xl lg:text-5xl">
                        <a href="/">whx's Blog</a>
                    </div>
                    <ul>
                        <li class="inline-block mt-6 mx-5 text-base hover:underline">
                                <a href="/about">About</a>
                            </li>
                        <li class="inline-block mt-6 mx-5 text-base hover:underline">
                                <a href="/feed.xml">RSS</a>
                            </li>
                        <li class="inline-block mt-6 mx-5 text-base hover:underline">
                                <a href="/static/resume.pdf">resume</a>
                            </li>
                        </ul>
                </header>
                <div class="w-full h-32 md:h-36 lg:h-44 xl:h-48 2xl:h-56"></div>
            </div>
            <main class="pb-10 -translate-y-32 md:-translate-y-32 lg:-translate-y-36 xl:-translate-y-44 2xl:-translate-y-56 mx-auto sm:max-w-scree-md md:max-w-screen-lg">
                <div class="p-4 pb-10 md:p-8 md:pb-14 mx-4 my-6 bg-white shadow-xl shadow-slate-700/10 ring-1 ring-gray-900/5">
        <div class="relative mx-2">
            <a class="before:block before:absolute before:-inset-1 before:-skew-x-6 before:bg-primary relative inline-block transition sm:hover:scale-110 duration-500"
               href="/s3">
                <div class="relative text-main px-4">2023</div>
            </a>
            <span class="ml-2 text-gray-700">/  第 ⁨2⁩ 篇</span>
        </div>
        <div class="mt-4 mb-8 w-full border-dashed border-t border-slate-300"></div>
        <div class="prose mx-auto">
            <h1 class="text-center">AI 来了</h1>
            <div class="flex items-center justify-between text-gray-500">
                <span>2023-03-17</span>
                <a class="flex items-center px-2 py-1 !text-gray-500 rounded hover:bg-gray-200 hover:!no-underline"
           href="/@whx">
            <img class="!m-0 !p-1 w-7 h-7 rounded-full object-cover"
                 src="/static/avatar.png"
                 alt="avatar"
                 loading="lazy">
            <span>
                whx
                </span>
        </a>
    
            </div>
        </div>
        <article class="prose mx-auto my-12">
            <p>今天晚上有点累，同时闲得无聊，而且最近总被 GPT-4/ChatGPT/文心一言刷屏，突然也想跟把风玩玩 AI。</p>
<p>上网冲浪找到了这个项目：<a href="https://github.com/setzer22/llama-rs">LLaMA-rs</a>，是 <a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a> 的 Rust 版本，正好 MacBook 也能跑，比较适合我。<br />
我尝试着 clone 了项目，想着看看能不能跑通，权当娱乐。</p>
<p>需要这么几步操作：</p>
<ol>
<li>
<p>首先你需要准备 LLaMA 模型，常规操作是到 facebook 那里慢悠悠地填邮件，等人家给你发链接，不过晚吃瓜有晚吃瓜的好处，网友是万能的，现在磁力链接都有了：<br />
<code>magnet:?xt=urn:btih:ZXXDAUWYLRUXXBHUYEMS6Q5CE5WA3LVA&amp;dn=LLaMA</code></p>
</li>
<li>
<p>简单瞅瞅，这些模型太大，我只是想玩一下，所以选择了最小的 7B</p>
</li>
<li>
<p>模型下载好之后需要按照 <a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a> 项目的步骤继续：</p>
<ol>
<li>把模型挪到 <code>./models</code> 下</li>
<li>安装必要的依赖：<code>python3 -m pip install torch numpy sentencepiece</code></li>
<li>将 7B 模型转换为 ggml FP16 格式：<code>python3 convert-pth-to-ggml.py models/7B/ 1</code></li>
<li>将模型量化为 4 位：<code>./quantize.sh 7B</code></li>
</ol>
</li>
<li>
<p>通过上面一顿操作你就得到了 <code>./models/7B/ggml-model-q4_0.bin</code> 这个文件</p>
</li>
<li>
<p>友情提示下载的模型就有 10 几个 G，转化好的玩意也有 4G 多，所以你最好在等下载&amp;运行转换命令的时候找点事做，不然会非常无聊（说好的娱乐向呢。。。）</p>
</li>
<li>
<p>接下来 clone <a href="https://github.com/setzer22/llama-rs">LLaMA-rs</a> 项目，在 LLaMA-rs 项目的根目录下执行 <code>cargo build --release</code>，构建 Rust 项目（熟悉 Rust 的要注意目前 debug 模式会报错，必须是 release 模式才行）</p>
</li>
<li>
<p>构建完成之后就可以用 <code>cargo run --release -- &lt;ARGS&gt;</code> 命令运行了，人家给的例子是 <code>cargo run --release -- -m /data/Llama/LLaMA/7B/ggml-model-q4_0.bin -p &quot;Tell me how cool the Rust programming language is:</code> </p>
</li>
<li>
<p>一切顺利你会看到结果，大功告成！我跑出来的东西是这样的：</p>
</li>
</ol>
<p><img src="../../static/2023/llama-rs-result.png" alt="" loading="lazy"></p>
<blockquote>
<p>Tell me how cool the Rust programming language is: </p>
<ol>
<li>It’s compiled using standard techniques, but it has no runtime library (all classes are inlined into executables). So all kinds of things you wouldn’t normally have to worry about compile-time. </li>
<li>It can create a complete binary application from an XML file that specifies the class hierarchy and relationships - no other code is necessary or allowed! </li>
<li>The programming language looks like Java, but it has none of the overhead – it runs in memory at normal speed on modern hardware (i5+MacBookPro here). I’m really loving this because I can now write C-like</li>
</ol>
</blockquote>
<blockquote>
<p>告诉我，Rust 编程语言有多酷：<br />
1）它是使用标准技术编译的，但是它没有运行时库（所有类都插入了可执行文件中）。因此，您通常不必担心编译时的各种事情。<br />
2）它可以从 XML 文件中创建一个完整的二进制应用程序，该应用程序指定类层次结构和关系 - 不需要或允许其他代码！<br />
3）编程语言看起来像 Java，但没有开销 - 它以现代硬件的正常速度（i5+MacBookPro）在内存中运行。我真的很喜欢这个，因为我现在可以写类 C 语言</p>
</blockquote>
<p>AI 还是有点意思的，第一条还像那么回事，Rust 官方的确没有提供运行时，但是这意味着有更多的工作要在编译时去做啊，AI 的逻辑让人哭笑不得；<br />
第二条更加离谱，如果这里说 TOML 文件将是绝杀，可惜换不得；第三条又是说对了一部分，Rust 的确快，但和 Java 并没多少相似之处。</p>
<hr />
<p>再来看基于 Stanford Alpaca 的 <a href="https://github.com/antimatter15/alpaca.cpp">alpaca.cpp</a> 项目的神奇操作，步骤和前面的差不多，但是效果更好：</p>
<p><img src="../../static/2023/alpaca-cpp.png" alt="" loading="lazy"></p>
<blockquote>
<p>Rust has been described as “the most exciting new development in software engineering since C++”. It combines safety and performance, with a focus on correctness that makes it ideal for writing safe code. Rust also offers great tooling support from the community which allows you to write better programs faster than ever before!</p>
</blockquote>
<blockquote>
<p>Rust 被描述为“自 C++ 以来软件工程领域最激动人心的新发展”。它结合了安全性和性能，并注重正确性，这使其成为编写安全代码的理想选择。Rust 还提供来自社区的强大工具支持，使您能够比以往更快地编写更好的程序！</p>
</blockquote>
<p>这个效果就比前者好太多了，基本没有错误！</p>
<p>最恐怖的是，所有的这一切都是在我这台 2016 的老 MacBook 上完成的，没有什么显卡/GPU 加持，完全靠 CPU 也能做到这种程度，这样看来 ChatGPT 那种神乎其技的表现也就不足为奇了，所谓图灵测试根本是难不住它们的，依照这个速度发展下去，奇点一定会到来；<br />
这个世界太疯狂，未来会变成什么样子，真是令人期待！</p>

            </article>
        <div class="my-4 w-full border-dashed border-t border-slate-300"></div>
            <div class="flex flex-col md:flex-row">
                <a class="inline my-1 py-2 px-4 font-bold text-slate-700 hover:underline"
                           href="/s3/1">
                            上一篇：
                            2022 总结
                        </a>
                    <a class="inline my-1 py-2 px-4 font-bold text-slate-700 hover:underline"
                           href="/s3/3">
                            下一篇：
                            从 Happened-before 说起（1）
                        </a>
                    </div>
        </div>
    </main>
            <footer class="relative">
                <footer class="bg-black text-white text-center p-16">
    <div>
        <a href="https://github.com/whx828">Copyright © 2022-2023 whx</a>
    </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
<script>
    document.getElementsByClassName('bg-primary')[0].setAttribute("id", "vanta");
    document.getElementById('vanta').classList.remove('bg-primary');
    window.addEventListener('DOMContentLoaded', () => {
        VANTA.WAVES({
            el: "#vanta",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            scaleMobile: 1.00,
            shininess: 150.00,
            waveHeight: 37.50,
            waveSpeed: 1.50,
            zoom: 0.97
        })
    });
</script>
<script src="https://app.embed.im/snow.js" defer></script>
<style>
    .vanta {
        z-index: 0;
        position: relative;
        left: 0;
        right: 0;
        width: 100%;
        height: 100%;
    }

    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap');
</style><a href="https://github.com/zineland"
                   class="absolute z-20 bottom-0 w-full text-center font-bold md:text-slate-100 md:opacity-10 md:hover:opacity-50 md:bg-transparent bg-primary p-2 text-main">
                    Proudly powered by Zine.
                </a>
            </div>
        </footer>
    </body>
    <script src="/static/medium-zoom.min.js"></script>
    <script src="/static/zine.js"></script>
</html>
